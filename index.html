<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BY DERA - SMART ENGINE</title>

<style>
body{
    background:#0e0e0e;
    font-family:Arial;
    color:white;
    text-align:center;
    margin:0;
    padding:15px;
}

.title{font-size:20px;margin-bottom:15px;}

.label{
    color:#ffd000;
    text-align:left;
    width:90%;
    margin:auto;
    margin-top:10px;
}

.box{
    width:90%;
    padding:12px;
    margin:8px auto;
    background:#1b1f24;
    border:2px solid #ffd000;
    border-radius:10px;
    color:white;
    font-size:16px;
    text-align:center;
}

.btn{
    width:90%;
    padding:14px;
    background:#00c853;
    border:none;
    border-radius:10px;
    font-weight:bold;
    margin-top:10px;
}

.result{
    background:#d50000;
    padding:12px;
    margin-top:15px;
    border-radius:10px;
}

.countdown{
    margin-top:10px;
    font-size:18px;
    color:#00ff66;
}

.history{
    margin-top:15px;
    background:#1b1f24;
    padding:10px;
    border-radius:10px;
    text-align:left;
}
.history h3{color:#ffd000;}
</style>
</head>

<body>

<div class="title">BY DERA - SMART ENGINE</div>

<div class="label">ðŸ•’ HEURE (HH:MM:SS)</div>
<input class="box" id="heure" placeholder="01:31:57">

<div class="label"># HASH</div>
<input class="box" id="hash" placeholder="abc123xyz">

<button class="btn" onclick="calculate()">âš¡ CALCULER</button>

<div class="result" id="resultBox">
RÃ©sultat : - <br>Heure finale : -
</div>

<div class="countdown" id="countdown"></div>

<div class="history">
<h3>Historique</h3>
<div id="historyList"></div>
</div>

<script>

let historyArray = [];
let countdownInterval;

// ðŸ”¥ MÃ©lange HASH + HEURE
function mixHashTime(hash, time){

    let combined = hash + time;
    let total = 0;

    for(let i=0;i<combined.length;i++){
        total = (total * 31 + combined.charCodeAt(i)) % 1000000007;
    }

    return total;
}

function calculate(){

    let timeInput = document.getElementById("heure").value;
    let hash = document.getElementById("hash").value;

    if(timeInput=="" || hash==""){
        alert("Fenoy daholo!");
        return;
    }

    let engineValue = mixHashTime(hash, timeInput);

    // ðŸŽ¯ RÃ©sultat [2.01 â€“ 1000]
    let resultValue = (2.01 + (engineValue % 997.99)).toFixed(2);

    // â± DurÃ©e tour (15 sec â†’ 180 sec)
    let durationSeconds = (engineValue % 165) + 15;

    let parts = timeInput.split(":");

    let baseDate = new Date();
    baseDate.setHours(parts[0]);
    baseDate.setMinutes(parts[1]);
    baseDate.setSeconds(parts[2]);

    let nextDate = new Date(baseDate.getTime() + durationSeconds*1000);

    let nextTime =
        nextDate.getHours().toString().padStart(2,'0') + ":" +
        nextDate.getMinutes().toString().padStart(2,'0') + ":" +
        nextDate.getSeconds().toString().padStart(2,'0');

    document.getElementById("resultBox").innerHTML =
        "RÃ©sultat : " + resultValue + "x" +
        "<br>DurÃ©e tour : " + durationSeconds + " sec" +
        "<br>Heure tour manaraka : " + nextTime;

    addHistory(resultValue + "x â†’ " + nextTime);

    startCountdown(nextDate);
}

function startCountdown(targetDate){

    clearInterval(countdownInterval);

    countdownInterval = setInterval(function(){

        let now = new Date();
        let diff = Math.floor((targetDate - now)/1000);

        if(diff <= 0){
            document.getElementById("countdown").innerHTML =
                "ðŸš€ Tour manaraka izao!";
            clearInterval(countdownInterval);
            return;
        }

        let minutes = Math.floor(diff / 60);
        let seconds = diff % 60;

        document.getElementById("countdown").innerHTML =
            "Countdown: " + minutes + "m " + seconds + "s";

    },1000);
}

function addHistory(value){

    historyArray.unshift(value);
    if(historyArray.length > 10){ historyArray.pop(); }

    let list = document.getElementById("historyList");
    list.innerHTML = "";

    historyArray.forEach(function(item){
        list.innerHTML += "<div>"+item+"</div>";
    });
}

</script>

</body>
</html>
